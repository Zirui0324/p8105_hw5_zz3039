p8105_hw5_zz3039
================
2022-11-13

## Problem 2

Import data

``` r
homicide_data = 
  read.csv("./data/homicide-data.csv") %>% 
  janitor::clean_names() %>% 
  mutate(
    city_state = paste(city, state, sep=", ")
  ) %>% 
  select(city_state, - city, - state, everything())
```

Sum over number of cases

``` r
homi_sum = 
  homicide_data %>% 
  group_by(city_state) %>% 
  summarize(
    n_homicide = n(),
    n_unsolved = sum(disposition != "Closed by arrest"))
```

Prop.test for baltimore

``` r
balti = 
  homi_sum %>% 
  filter(city_state == "Baltimore, MD")

balti_test = 
  prop.test(balti$n_unsolved, balti$n_homicide) %>% 
  broom::tidy() %>% 
  mutate(
    conf.low = round(conf.low, digits = 3),
    conf.high = round(conf.high, digits = 3)
  )

tibble(
  balti_es = balti_test$estimate,
  balti_ci = paste(balti_test$conf.low, balti_test$conf.high, sep=", ")
)
```

    ## # A tibble: 1 × 2
    ##   balti_es balti_ci    
    ##      <dbl> <chr>       
    ## 1    0.646 0.628, 0.663

Prop.test for every city

``` r
homi_prop = 
  homi_sum %>% 
  mutate(
    prop = 
      map2(.x = n_unsolved, .y = n_homicide, ~prop.test(x = .x, n = .y)),
    prop_test =
      map(prop, broom::tidy)) %>% 
  select(city_state, prop_test)
  

homi_prop_extrct = 
  homi_prop %>% 
  unnest(prop_test) %>%
  select(city_state, estimate, conf.low, conf.high) %>% 
  mutate(
    estimate = round(estimate, digits = 3),
    conf.low = round(conf.low, digits = 3),
    conf.high = round(conf.high, digits = 3),
    CI = str_c("(", conf.low,", ", conf.high, ")")) %>% 
  select(city_state, estimate, CI, everything())
```

Plot

``` r
homi_prop_extrct %>% 
  mutate(
    city_state = fct_reorder(city_state, estimate)
  ) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point(color = "grey") +
  geom_errorbar(mapping=aes(x = city_state, ymin = conf.low, ymax = conf.high), width=0.05, size=1, color="light blue") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

<img src="p8105_hw5_zz3039_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

## Problem 3

``` r
p3_sim = function(n, mu = 0, sigma = 5) {
  
  sim_data = tibble(
    x = rnorm(n, mean = mu, sd = sigma),
  )

  t_test = 
    t.test(sim_data$x, alternative = c("two.sided"), mu = 0) %>% 
    broom::tidy()
  
  tibble(
    mu_hat = mean(sim_data$x),
    p_value = t_test$p.value
  )
}

output = vector("list", 5000)

for (i in 1:5000) {
  output[[i]] = p3_sim(30)
}

sim_results = bind_rows(output)
sim_results
```

    ## # A tibble: 5,000 × 2
    ##     mu_hat p_value
    ##      <dbl>   <dbl>
    ##  1  0.964    0.168
    ##  2  0.907    0.305
    ##  3  1.27     0.172
    ##  4 -0.648    0.367
    ##  5  0.455    0.558
    ##  6  0.572    0.568
    ##  7  0.0166   0.985
    ##  8  0.723    0.407
    ##  9 -0.374    0.750
    ## 10  0.310    0.710
    ## # … with 4,990 more rows
